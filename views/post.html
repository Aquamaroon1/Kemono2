{% extends 'components/shell.html' %}
{% block content %}
<div class="views">
  <div class="sidebar" style="margin-right: 20px;">
    <span class="subtitle">Click on the thumbnails to reveal the original resolution image.</span>
    <h1>Information</h1>
    <div class="results" id="results">
      <li>
        User: <a href="../">{{ props.artist.name }}</a>
      </li>
      <li>
        ID: <a href="">{{ request.url }}</a>
      </li>
      <li>
        Published at: {{ post.published }}
      </li>
      <li>
        Added at: {{ post.added }}
      </li>
      {% if props.flagged %}
        <li><span class="subtitle">This post has been flagged for reimport.</span></li>
      {% else %}
        <li><a href="javascript:;" id="flag-button">Flag for reimport</a> </li>
      {% endif %}
      {% if props.favorited %}
        <li class="subtitle">
          ★ Favorited <a href="javascript:unfavorite_post('{{ post.service }}', '{{ post.user }}', '{{ post.id }}');">(☆)</a>
        </li>
      {% else %}
        <li>
          <a href="javascript:favorite_post('{{ post.service }}', '{{ post.user }}', '{{ post.id }}');">☆ Favorite</a>
        </li>
      {% endif %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/unfetch@4.1.0/polyfill/index.js"></script>
    <script src="{{ url_for('static', filename='js/post.js') }}"></script>
  </div>
  <div class="page" id="page">
    {% set previews = result_previews %}
    {% set attachments = result_attachments %}
    {% if post.shared_file %}
      <p class="subtitle">This post is user-shared, and cannot be verified for integrity. Exercise caution.</p>
    {% endif %}
    {% if post.service == 'dlsite' and post.attachments|length > 1 %}
      <p class="subtitle">
        This DLsite post was received as a split set of multiple files due to file size. Download all the files, then open the .exe file to compile them into a single one.
      </p>
    {% endif %}
    {# title hidden with subscribestar posts to prevent redundancy #}
    <h1>{{ post.title if post.service != 'subscribestar' }}</h1>
    {% for attachment in attachments %}
      <a href="{{ attachment.path }}" target="_blank">
        Download {{ attachment.name }}
      </a>
      <br>
    {% endfor %}
    <p>{{ post.content|safe }}</p>
    {% for preview in previews %}
      {% if preview.type == 'thumbnail' %}
        <a class="fileThumb" href="{{ preview.path }}">
          <img
            data-src="/thumbnail{{ preview.path }}"
            src="/thumbnail{{ preview.path }}"
          >
        </a>
        <br>
      {% elif preview.type == 'embed' %}
        <a href="{{ preview.url }}" target="_blank">
          <div class="embed-view">
            {{ '<h3>'|safe ~ preview.subject ~ '</h3>'|safe if preview.subject else '<h3 class="subtitle">(No title)</h3>'|safe }}
            {{ '<p>'|safe ~ preview.description ~ '</p>'|safe if preview.description }}
          </div>
        </a>
        <br>
      {% endif %}
    {% endfor %}
  </div>
</div>
<script src="{{ url_for('static', filename='js/expander.js') }}"></script>
{% endblock %}